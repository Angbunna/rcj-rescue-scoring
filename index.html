<html>
  <head>
    <title>Drag and Drop Demo</title>

    <script type="text/javascript"
            src="//ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
    <script src="lvl-uuid.js"></script>
    <script src="lvl-drag-drop.js"></script>

    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">

    <style>
      .lvl-over {
      /* applied to a drop target when a draggable object is over it */
      border: 2px dashed black !important;
      }

      .lvl-target {
      /* applied to all drop targets when a drag operation begins, used to indicate drop targets on a page */
      background-color: #ddd;
      opacity: .5;
      }

      [draggable] {
      -moz-user-select: none;
      -khtml-user-select: none;
      -webkit-user-select: none;
      user-select: none;
      /* Required to make elements draggable in old WebKit */
      -khtml-user-drag: element;
      -webkit-user-drag: element;
      cursor: move;
      border:1px solid black;
      }

      .peg {
      text-align: center;
      font-weight: bold;
      border:1px black solid;
      width: 75px;
      margin: 10px;
      }

      .slot {
      margin-right:2px;
      margin-top:2px;
      width:40px;
      height:40px;
      display:inline-block;
      border: none;
      background-color: lightgreen;
      }

      .red {
      background-color: red;
      }

      .blue {
      background-color: blue;
      }

      .green {
      background-color: green;
      }

      .black {
      background-color: black;
      color: white;
      }

      .grey {
      background-color: grey;
      }

      tile{
      width: 40px;
      height: 40px;
      margin: 0px;
      display: block;
      }

      .tile-image{
        width: 40px;
        height: 40px;
      }
      .tools .tile-image{
        margin: 5px;
      }

      .rot0 {
        -webkit-transform: rotate(0deg);
        -moz-transform: rotate(0deg);
        -ms-transform: rotate(0deg);
        -o-transform: rotate(0deg);
        transform: rotate(0deg);
      }

      .rot90 {
        -webkit-transform: rotate(90deg);
        -moz-transform: rotate(90deg);
        -ms-transform: rotate(90deg);
        -o-transform: rotate(90deg);
        transform: rotate(90deg);
      }

      .rot180 {
        -webkit-transform: rotate(180deg);
        -moz-transform: rotate(180deg);
        -ms-transform: rotate(180deg);
        -o-transform: rotate(180deg);
        transform: rotate(180deg);
      }

      .rot270 {
        -webkit-transform: rotate(270deg);
        -moz-transform: rotate(270deg);
        -ms-transform: rotate(270deg);
        -o-transform: rotate(270deg);
        transform: rotate(270deg);
      }


    </style>
  </head>
  <body ng-app="ddApp">
    <h1>Rescue Line map editor</h1>
    <p>Draw the tiles to the field to create a new layout {{value}}</p>

    <div ng-controller="ddController" style="margin-top:50px;">
      <div class="row">
        <div class="col-md-3 tools">
          <div x-lvl-draggable="true" ng-repeat="tile in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]" class="tile-image">
            <img src="tiles/tile-{{tile}}.png" rotate-on-click="90" class="tile-image">
          </div>
        </div>
        <div class="col-md-9">
          <div ng-repeat="r in [0,1,2,3,4,5,6,7,8,9]">
            <div ng-repeat="c in [0,1,2,3,4]" class="slot">
              <tile tiles="tiles" x="{{c}}" y="{{r}}"  x-lvl-draggable='true' x-lvl-drop-target="true" x-on-drop="dropped(dragEl, dropEl)" ></tile>
              <!--
              <div ng-repeat="tile in tiles | filter: {x: col, y: row}">
                <img src="tiles/{{tile.image}}" class="rot{{tile.rot}} tile-image" ng-show="tile.image">
              </div>
              -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
<script>
    // register the directive with your app module
    var app = angular.module('ddApp', ['lvl.directives.dragdrop']);


    // function referenced by the drop target
    app.controller('ddController', ['$scope' , function($scope){
      $scope.dropped = function(dragEl, dropEl) {
        //the directive provides a native dom object, wrap with jqlite
        var drop = angular.element(dropEl); // The div where i dropped the tile
        var drag = angular.element(dragEl); // The div where I lifted this tile

        console.log("adsf");

        //add the dragged image
        var path = drag.attr("src");
        console.log(path);
        drop.attr('src', path);

        //if element has been dragged from the grid, clear dragged color
        if (drag.attr("x-lvl-drop-target")) {
          drag.attr('src', 'tiles/tile-empty.png');
        }
      }

      $scope.tiles = {};

      $scope.tiles["2,3"] = {rot: '0',   image: 'tile-5.png'};
      $scope.tiles["2,4"] = {rot: '0'};
      $scope.tiles["2,5"] = {rot: '270', image: 'tile-6.png'};
      $scope.tiles["3,3"] = {rot: '90',  image: 'tile-4.png'};
      $scope.tiles["3,4"] = {rot: '90',  image: 'tile-4.png'};
      $scope.tiles["3,5"] = {rot: '180'};

    }]);


    app.directive('tile', function() {
      return {
       scope: {
          x: '@',
          y: '@',
          tiles: '=tiles'
        },
        restrict: 'E',
        templateUrl: 'tile.html'
      };
    });


    app.directive('rotateOnClick', function() {
      return {
        restrict: 'A',
        link: function(scope, element, attrs) {
          var deg = 0;
          element.bind('click', function() {
            deg+= parseInt(attrs.rotateOnClick, 10);
            element.css({
              webkitTransform: 'rotate('+deg+'deg)',
              mozTransform: 'rotate('+deg+'deg)',
              msTransform: 'rotate('+deg+'deg)',
              oTransform: 'rotate('+deg+'deg)',
              transform: 'rotate('+deg+'deg)'
            });
          });
        }
      };
    });
</script>
</html>
